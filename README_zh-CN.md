
# MPV-SyncBangumi 脚本

这是一个为 [MPV Player](https://mpv.io/) 编写的Lua脚本，用于将你的本地观看记录自动同步到 [Bangumi](https://bgm.tv)。

## ✨ 功能特性

- **自动匹配**: 根据视频文件名自动搜索并匹配Bangumi上的动画条目和集数。
- **自动更新观看状态**:
    - 开始播放时，如果条目状态为“想看”或“未收藏”，脚本会自动更新为“在看”。
    - 当视频播放进度超过80%时，会自动将该集标记为“看过”。
- **自动完结**: 当一部动画的所有正片都被标记为“看过”后，脚本会自动将整个条目的状态更新为“看过”。
- **状态显示**: 通过OSD消息实时反馈当前的同步状态、番剧信息和操作结果。
- **灵活控制**: 可以通过快捷键随时开启或关闭同步功能。
- **调试模式**: 内置Debug开关，方便开发者或高级用户查看详细的API交互日志。

## 🚀 安装与配置

### 1. 安装

将此仓库克隆到你的MPV `scripts` 目录下。

```bash
git clone https://github.com/witcheng1024/synbangumi.git
```
这将在你的 `scripts` 目录下创建一个名为 `synbangumi` 的文件夹，其中包含 `synbangumi.lua` 等必要文件。

*(注意: 如果仓库中不包含 `json.lua`，请确保它位于 `scripts/bin` 等子目录中。)*

### 2. 获取 Access Token

1.  访问你的 [Bangumi API](https://bgm.tv/dev/app) 页面。
2.  创建一个新应用（如果还没有的话），并获取你的个人 `Access Token`。

### 3. 创建配置文件

1.  在你的MPV `script-opts` 目录下，创建一个名为 `synbangumi.conf` 的文件。
2.  在文件中添加以下内容，并填入你的 `Access Token` 和 Bangumi 用户名：

    ```ini
    # Bangumi Access Token (必需)
    access_token=你的ACCESS_TOKEN粘贴到这里

    # Bangumi 用户名 (可选，但推荐填写)
    username=你的Bangumi用户名

    # 是否开启调试模式 (可选, true 或 false, 默认 false)
    # 开启后会在控制台输出详细的API请求和响应信息
    debug_mode=false
    ```

## ⌨️ 使用方法

- **启动播放**: 正常播放你的动画视频文件。脚本会在文件加载时自动开始工作。
- **快捷键 `Ctrl+g`**:
    - **第一次按下**: 开启当前视频的同步功能。脚本会开始匹配番剧并更新状态。
    - **再次按下**: 手动关闭当前视频的同步功能。
- **自动同步**: 一旦同步开启，脚本将在后台自动处理所有观看进度的更新，无需任何额外操作。

## 📝 待办事项 (ToDo)

- **手动匹配**: 为解决文件名解析失败或不准确的问题，增加一个手动匹配功能，允许用户通过快捷键输入动漫名（subject）和集数（episode）。

## ⚠️ 注意事项

- **文件名规范**: 为了提高匹配成功率，请尽量使用包含番剧名和集数的、较为规范的文件名。例如：
    - `[SubsPlease] Boku no Hero Academia - 01 (1080p) [F02B9616].mkv`
    - `梦想成为魔法少女_S1E12.mkv`
    - `【喵萌奶茶屋】★04月新番★[跃动青春/Skip and Loafer][01][1080p][繁日双语][招募翻译].mp4`
- **网络连接**: 脚本需要正常的网络连接才能访问Bangumi API。
- **首次使用**: 推荐在MPV的控制台模式下运行，以便观察脚本的初始化和API测试过程是否成功。

---
祝您同步追番愉快！
